"use strict";angular.module("radioVcpApp",["angularSoundManager","ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]).controller("appCtrl",["Radio",function(a){a.init()}]),angular.module("radioVcpApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("radioVcpApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("radioVcpApp").directive("header",function(){return{templateUrl:"views/headerDirective.html",restrict:"C"}}),angular.module("radioVcpApp").directive("ticket",function(){return{templateUrl:"views/ticketDirective.html",restrict:"C",controller:"ticketCtrl as ticket"}}).controller("ticketCtrl",["$rootScope","Radio",function(){}]),angular.module("radioVcpApp").controller("ticketPlayerCtrl",["$rootScope","Radio",function(a,b){var c=!1;this.togglePlay=function(){this.isPlaying()?(c=!1,b.pause()):(c=!0,b.play())},this.tryPlaying=function(){return c},this.isPlaying=function(){return b.isPlaying()}}]).directive("ticketPlayer",function(){return{templateUrl:"views/ticketPlayerDirective.html",restrict:"A",controller:"ticketPlayerCtrl as ticketPlayer"}}),angular.module("radioVcpApp").service("Radio",["$q","$rootScope","$timeout","$http","YQL","angularPlayer",function(a,b,c,d,e,f){var g="e60722b92f458ca42ab21d9e7314e20e",h=a.defer(),i=0,j=function(){var b=a.defer();return window.parseMusic=function(a){b.resolve(a)},d.jsonp(o.URL_INFOS),b.promise},k=function(b,c){var d=a.defer(),f={method:"track.getInfo",api_key:g,artist:b,track:c,format:"json"},h=o.LASTFM_URL+"?"+_.map(f,function(a,b){return b+"="+a}).join("&");return e.get(h).then(function(a){a.json&&a.json.error?d.reject(a.message):d.resolve(a)}),d.promise},l=function(b,c){var d=a.defer(),f={method:"track.getInfo",api_key:g,artist:b,album:c,format:"json"},h=o.LASTFM_URL+"?"+_.map(f,function(a,b){return b+"="+a}).join("&");return e.get(h).then(function(a){d.resolve(a.json&&a.json.error?{album:{}}:a)}),d.promise},m=function(a){var b=/([^-]*)-([^\[]*)\[([^\\]*)\]/.exec(a);return{artist:b[1],title:b[2],album:b[3]}};window.angularPlayer=f,b.$on("angularPlayer:ready",function(){h.resolve()}),b.$on("currentTrack:position",function(a,b){i=b});var n=function(){};n.createFromLastFm=function(a,b,c,d){var e={name:c.title,artist:{name:c.artist},album:{name:c.album}};return _.extend(e,b,a.track||{}),e.__proto__=n.prototype,e.createdTime=moment(),e.radio=d,e},n.prototype.getId=function(){return this.id},n.prototype.getName=function(){return this.name},n.prototype.getDuration=function(){return parseInt(this.duration,10)},n.prototype.getArtist=function(){return this.artist},n.prototype.getArtistName=function(){return this.artist.name},n.prototype.getAlbum=function(){return this.album},n.prototype.getAlbumName=function(){return this.album.name},n.prototype.getCover=function(a){var b=this,a=a||"large",c=_.merge([],b.image,_.get(b,"album.image")),d=_.find(c,{size:a})||c[0]||null;return d&&d._text?d._text:null};var o=function(){};return o.URL_BASE="http://radio.vendredicestpermis.com",o.URL_INFOS=o.URL_BASE+"/jsonp.xsl",o.LASTFM_URL="http://ws.audioscrobbler.com/2.0/",o.MB_URL="http://musicbrainz.org/ws/2/release",o.MB_COVER_URL="http://ia802507.us.archive.org/3/items/mbid-_MBID_/mbid-_MBID__files.xml",o.prototype.infos=null,o.prototype.currentId=null,o.prototype.current=null,o.prototype.isFirstTrack=!0,o.prototype.track=null,o.prototype.updateRadioInfo=function(){var a=this;return j().then(function(b){a.infos=b;var c=a.current&&a.current.title?a.current.title:null;a.current=_.find(b,{server_name:a.currentId});var d=c!=a.current.title;return d&&console.log("IceCast infos Updated :",a.current),d})},o.prototype.updateTrackInfo=function(){var c=this,d=m(c.current.title);return a.all([k(d.artist,d.title),l(d.artist,d.album)]).then(function(a){c.track&&(c.isFirstTrack=!1),c.track=n.createFromLastFm(a[0],a[1],d,c),console.log("Track Updated :",c.track),b.$emit("Radio:TrackUpdated",c.track)})},o.prototype.updateAllIfNecessary=function(){var a=this;return this.updateRadioInfo().then(function(b){return b?a.updateTrackInfo():void 0})},o.prototype.init=function(){var a=this;return this.currentId="radio_VCP",a.updateAllIfNecessary(),setInterval(function(){a.updateAllIfNecessary()},1e3),this},o.prototype.getTrack=function(){return this.track},o.prototype.play=function(){return this.getTrack()&&this.playCurrent(),this},o.prototype.pause=function(){f.pause()},o.prototype.isPlaying=function(){return f.isPlayingStatus()&&i>0},o.prototype.isReady=function(){return h.promise},o.prototype.playCurrent=function(){return this.isReady().then(function(){f.addTrack({id:this.getTrack().getId(),title:this.getTrack().getName(),artist:this.getTrack().getArtist(),url:this.current.url}),f.play()}.bind(this)),this},new o}]),angular.module("radioVcpApp").directive("svgPlay",function(){return{template:'<svg class="svg-play" version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="157.859px" height="157.871px" viewBox="0 0 157.859 157.871" enable-background="new 0 0 157.859 157.871" xml:space="preserve"><path fill="#FFFFFF" d="M79.046,0C35.448-0.066,0.063,35.225,0,78.818c-0.075,43.59,35.22,78.98,78.813,79.053c43.593,0.059,78.981-35.232,79.046-78.825C157.928,35.454,122.629,0.065,79.046,0z M50.308,126.006l14.155-47.599L50.308,30.775l82.475,47.615L50.308,126.006z"/></svg>',restrict:"E"}}),angular.module("radioVcpApp").controller("ticketInfoCtrl",["Radio",function(a){var b=this;b.getTrack=function(){return a.getTrack()}}]).directive("ticketInfo",function(){return{templateUrl:"views/ticketInfoDirective.html",restrict:"A",controller:"ticketInfoCtrl as ticketInfo"}}),angular.module("radioVcpApp").controller("ticketCoverCtrl",["Radio",function(a){var b="images/cover.cac50ffc.jpg",c=this;c.getCoverStyle=function(){b=!1;try{b=a.track.getCover()}catch(c){}return b?"background-image: url('"+b+"')":""}}]).directive("ticketCover",function(){return{templateUrl:"views/ticketCoverDirective.html",controller:"ticketCoverCtrl as tickerCover",restrict:"A"}}),angular.module("radioVcpApp").directive("svgPause",function(){return{template:'<svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="157.859px" height="157.871px" viewBox="0 0 157.859 157.871" enable-background="new 0 0 157.859 157.871" xml:space="preserve"><path fill="#DBDCDE" d="M79.046,0C35.448-0.066,0.063,35.225,0,78.818c-0.075,43.59,35.22,78.98,78.813,79.053c43.593,0.059,78.981-35.232,79.046-78.825C157.928,35.454,122.629,0.065,79.046,0z M72.539,121.953H48.631V38.773h23.908V121.953zM108.942,121.933H85.034V38.753h23.908V121.933z"/></svg>',restrict:"E"}}),angular.module("radioVcpApp").controller("ticketInfoProgressCtrl",["$rootScope","Radio",function(a,b){var c=this,d=0,e=0,f=0,g=0;a.$on("track:progress",function(a,b){e=b}),a.$on("currentTrack:position",function(a,b){d=b}),a.$on("Radio:TrackUpdated",function(a,b){f=b.getDuration(),g=b.createdTime}),c.getCurrentPosition=function(){return b.isFirstTrack?0:moment().diff(g)},c.getCurrentPercentage=function(){return 100*c.getCurrentPosition()/f},c.getCurrentDuration=function(){return f}}]).directive("ticketInfoProgress",function(){return{templateUrl:"views/ticketInfoProgressDirective.html",restrict:"A",controller:"ticketInfoProgressCtrl as ticketInfoProgress"}}),angular.module("radioVcpApp").filter("time",function(){return function(a){var b="",c=0,d=0;return a&&angular.isNumber(a)&&(a/=1e3,d=Math.floor(a/60),c=Math.round(a-60*d)),d=10>d?"0"+d:d,d>0&&(b=d+"' "),c=10>c?"0"+c:c,b+=c+'"'}}),angular.module("radioVcpApp").directive("svgCode",function(){return{template:'<svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="126.775px" height="12.144px" viewBox="0 0 126.775 12.144" enable-background="new 0 0 126.775 12.144" xml:space="preserve">\r\n    <g>\r\n        <g>\r\n            <path fill="#3C3D42" d="M3.809,12.144H2.674V0h1.135V12.144z M1.135,12.144H0V0h1.135V12.144z" /> </g>\r\n        <g>\r\n            <rect x="5.346" y="0" fill="#3C3D42" width="3.809" height="11.335" /> </g>\r\n        <g>\r\n            <rect x="10.693" y="0" fill="#3C3D42" width="2.471" height="11.335" /> </g>\r\n        <g>\r\n            <path fill="#3C3D42" d="M22.521,11.335h-1.137V0h1.137V11.335z M18.512,11.335h-1.137V0h1.137V11.335z" /> </g>\r\n        <g>\r\n            <path fill="#3C3D42" d="M31.877,11.335h-2.473V0h2.473V11.335z M27.867,11.335h-2.473V0h2.473V11.335z" /> </g>\r\n        <g>\r\n            <rect x="33.414" y="0" fill="#3C3D42" width="5.147" height="11.335" /> </g>\r\n        <g>\r\n            <path fill="#3C3D42" d="M50.59,11.335h-1.137V0h1.137V11.335z M47.916,11.335h-1.135V0h1.135V11.335z M41.232,11.335h-1.135V0			h1.135V11.335z" /> </g>\r\n        <g>\r\n            <rect x="52.127" y="0" fill="#3C3D42" width="5.144" height="11.335" /> </g>\r\n        <g>\r\n            <path fill="#3C3D42" d="M65.293,12.144h-1.137V0h1.137V12.144z M62.619,12.144h-1.135V0h1.135V12.144z M59.945,11.335h-1.135V0			h1.135V11.335z" /> </g>\r\n        <g>\r\n            <rect x="66.83" y="0" fill="#3C3D42" width="3.809" height="11.335" /> </g>\r\n        <g>\r\n            <path fill="#3C3D42" d="M79.994,11.335h-1.135V0h1.135V11.335z M77.322,11.335h-1.137V0h1.137V11.335z M74.648,11.335h-1.135V0			h1.135V11.335z" /> </g>\r\n        <g>\r\n            <path fill="#3C3D42" d="M93.361,11.335h-2.473V0h2.473V11.335z M88.014,11.335h-2.473V0h2.473V11.335z" /> </g>\r\n        <g>\r\n            <path fill="#3C3D42" d="M102.717,11.335h-1.137V0h1.137V11.335z M96.033,11.335h-1.135V0h1.135V11.335z" /> </g>\r\n        <g>\r\n            <path fill="#3C3D42" d="M110.736,11.335h-2.473V0h2.473V11.335z M106.727,11.335h-2.473V0h2.473V11.335z" /> </g>\r\n        <g>\r\n            <rect x="113.609" y="0" fill="#3C3D42" width="1.137" height="11.335" /> </g>\r\n        <g>\r\n            <rect x="116.283" y="0" fill="#3C3D42" width="3.809" height="11.335" /> </g>\r\n        <g>\r\n            <path fill="#3C3D42" d="M126.775,12.144h-1.137V0h1.137V12.144z M124.102,12.144h-1.135V0h1.135V12.144z" /> </g>\r\n    </g>\r\n</svg>\r\n',restrict:"E"}}),angular.module("radioVcpApp").service("YQL",["$http","$q",function(a,b){var c=function(){};return c.prototype.get=function(c){var d=b.defer();return a.get("http://query.yahooapis.com/v1/public/yql",{params:{q:'select * from json where url="'+encodeURI(c)+'"',format:"json"}}).success(function(a){d.resolve(a.query.results)}),d.promise},new c}]),angular.module("radioVcpApp").directive("svgLogo",function(){return{template:'<svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="102.201px" height="36.37px" viewBox="0 0 102.201 36.37" enable-background="new 0 0 102.201 36.37" xml:space="preserve">\r\n    <g>\r\n        <path d="M50.173,36.37h-5.525L38.211,0.643h5.846l3.488,24.999l3.701-24.999h5.471L50.173,36.37z" />\r\n        <path d="M70.768,37.013c-5.204,0-8.637-3.648-8.637-8.528V8.529C62.131,3.647,65.564,0,70.768,0 c5.256,0,8.1,3.432,8.1,8.207v5.15h-5.043V8.1c0-1.717-0.965-2.951-2.949-2.951c-1.985,0-2.951,1.234-2.951,2.897v20.921 c0,1.663,0.966,2.896,2.951,2.896c1.984,0,2.949-1.232,2.949-2.949v-5.31h5.043v5.203C78.867,33.581,76.024,37.013,70.768,37.013z" />\r\n        <path d="M95.227,22.261h-3.434V36.37h-5.686V0.643h9.119c4.077,0,6.975,2.253,6.975,7.242v7.188 C102.201,20.009,99.304,22.261,95.227,22.261z M96.676,7.885c0-1.556-0.591-2.36-1.932-2.36h-2.951v12.177h2.951 c1.341,0,1.932-0.804,1.932-2.36V7.885z" />\r\n    </g>\r\n    <path d="M14.566,3.171C6.532,3.159,0.012,9.663,0,17.696c-0.014,8.034,6.49,14.555,14.523,14.567 c8.033,0.012,14.555-6.492,14.566-14.525C29.103,9.705,22.598,3.183,14.566,3.171z M9.271,26.392l2.608-8.771L9.271,8.842 l15.198,8.775L9.271,26.392z" />\r\n</svg>\r\n',restrict:"EC"}});